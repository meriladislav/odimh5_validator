
# makefile-commons.in
# settings for the makefile of the odimh5_validator software
# v_0.0, 04.2018, L. Meri, SHMU
###############################################################################

##############################################################
#please edit the HOME_DIR, CXX and H5CC variables according your system
##############################################################
HOME_DIR = $(shell pwd)
CXX = g++ 
H5CC = h5cc

##############################################################
#it is possible to edit the compiler flags but not recommended
##############################################################
CXX_FLAGS += -std=c++11 -O2 -Wall -Wextra -DH5_USE_18_API

##############################################################
#don`t edit anything below this unless you are sure of what you do
##############################################################
AR = ar
ARFLAGS = -rv

SRC_DIR = $(HOME_DIR)/src
OBJ_DIR = $(HOME_DIR)/obj
INC_DIR = $(HOME_DIR)/include
LIB_DIR = $(HOME_DIR)/lib
BIN_DIR = $(HOME_DIR)/bin

HDF_INST_DIR = $(shell $(H5CC) -showconfig | \
               grep "Installation point:" | \
               awk -F': ' '{print $$2}' )
HDF_FLAVOR_DIR = $(shell $(H5CC) -showconfig | \
                 grep "Flavor name:" | \
                 awk -F': ' '{print $$2}' )
INC_FLAGS = -I$(HDF_INST_DIR)/include/hdf5/$(HDF_FLAVOR_DIR) -I$(INC_DIR)

ifeq ($(HDF_DIR),'')
  LIB_FLAGS = 
else
  LIB_FLAGS = -L$(HDF_DIR)/lib
endif
LIB_FLAGS += -L$(LIB_DIR) \
            -Wl,--start-group \
            -lmyodimh5 \
            -lhdf5 
LIB_FLAGS += $(shell $(H5CC) -showconfig | \
                     grep "Extra libraries:" | \
                     awk -F': ' '{print $$2}' ) 
LIB_FLAGS += -lpthread -Wl,--end-group
            
 
