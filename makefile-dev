###############################################################################
# makefile
# makefile for the odimh5_validator software
# v_0.0, 04.2018, L. Meri, SHMU
###############################################################################

include makefile-commons.in

TEST_INC_FLAGS = $(INC_FLAGS) -I ~/wrk/inc
TEST_LIB_FLAGS = $(LIB_FLAGS) -L ~/wrk/lib -lmygmock

LIB_LIST = $(LIB_DIR)/libmyodimh5.a 
           
BIN_LIST = $(BIN_DIR)/odimh5-validate \
           $(BIN_DIR)/odimh5-check-value
           
TEST_LIST = $(BIN_DIR)/gtest_H5Layout \
            $(BIN_DIR)/gtest_OdimStandard \
            $(BIN_DIR)/gtest_Compare

OBJ_LIST = $(OBJ_DIR)/class_H5Layout.o \
           $(OBJ_DIR)/class_OdimEntry.o \
           $(OBJ_DIR)/class_OdimStandard.o \
           $(OBJ_DIR)/module_Compare.o

all : $(LIB_LIST) $(BIN_LIST) $(TEST_LIST)
	@echo ""
	@echo "###############################################################"
	@echo "# Congratulation! The odimh5_validator build was SUCCESSFULL.  "
	@echo "# Consider setting env variable: ODIMH5_VALIDATOR_CSV_DIR=$(PWD)/data - see also in the Readme.md file"
	@echo "###############################################################"
	@echo ""
	
test : $(TEST_LIST)
	export ODIMH5_VALIDATOR_CSV_DIR="./data" && $(BIN_DIR)/gtest_H5Layout
	export ODIMH5_VALIDATOR_CSV_DIR="./data" && $(BIN_DIR)/gtest_OdimStandard
	export ODIMH5_VALIDATOR_CSV_DIR="./data" && $(BIN_DIR)/gtest_Compare

	
clean: 
	rm -rf $(BIN_DIR)/* \
	       $(LIB_DIR)/* \
	       $(OBJ_DIR)/* 
	       
$(LIB_DIR)/libmyodimh5.a: $(OBJ_LIST)
	@echo ""
	@echo "Creating lib ..."
	$(AR) $(ARFLAGS) $@ $(OBJ_LIST) 
	@echo "Creating lib ... OK"
	@echo ""


$(BIN_DIR)/odimh5-validate: $(SRC_DIR)/odimh5-validate.cpp $(LIB_LIST)
	@echo ""
	@echo "Compiling odimh5-validate ..."
	$(CXX) $(CXX_FLAGS) $(INC_FLAGS) -o $@ $(SRC_DIR)/odimh5-validate.cpp $(LIB_FLAGS) 
	@echo "Compiling odimh5-validate ... OK"
	@echo ""
	
$(BIN_DIR)/odimh5-check-value: $(SRC_DIR)/odimh5-check-value.cpp $(LIB_LIST)
	@echo ""
	@echo "Compiling odimh5-check-value ..."
	$(CXX) $(CXX_FLAGS) $(INC_FLAGS) -o $@ $(SRC_DIR)/odimh5-check-value.cpp $(LIB_FLAGS) 
	@echo "Compiling odimh5-check-value ... OK"
	@echo ""
	
$(BIN_DIR)/gtest_H5Layout: $(SRC_DIR)/gtest_H5Layout.cpp $(LIB_LIST)
	$(CXX) $(CXX_FLAGS) $(TEST_INC_FLAGS) -o $@ $(SRC_DIR)/gtest_H5Layout.cpp $(TEST_LIB_FLAGS) 
	
$(BIN_DIR)/gtest_OdimStandard: $(SRC_DIR)/gtest_OdimStandard.cpp $(LIB_LIST)
	$(CXX) $(CXX_FLAGS) $(TEST_INC_FLAGS) -o $@ $(SRC_DIR)/gtest_OdimStandard.cpp $(TEST_LIB_FLAGS) 
	
$(BIN_DIR)/gtest_Compare: $(SRC_DIR)/gtest_Compare.cpp $(LIB_LIST)
	$(CXX) $(CXX_FLAGS) $(TEST_INC_FLAGS) -o $@ $(SRC_DIR)/gtest_Compare.cpp $(TEST_LIB_FLAGS) 
	
$(OBJ_DIR)/class_H5Layout.o: $(SRC_DIR)/class_H5Layout.cpp $(SRC_DIR)/class_H5Layout.hpp 
	$(CXX) $(CXX_FLAGS) $(INC_FLAGS) -c -o $@ $(SRC_DIR)/class_H5Layout.cpp

$(OBJ_DIR)/class_OdimEntry.o: $(SRC_DIR)/class_OdimEntry.cpp $(SRC_DIR)/class_OdimEntry.hpp 
	$(CXX) $(CXX_FLAGS) $(INC_FLAGS) -c -o $@ $(SRC_DIR)/class_OdimEntry.cpp  

$(OBJ_DIR)/class_OdimStandard.o: $(SRC_DIR)/class_OdimStandard.cpp $(SRC_DIR)/class_OdimStandard.hpp \
                                 $(OBJ_DIR)/class_OdimEntry.o
	$(CXX) $(CXX_FLAGS) $(INC_FLAGS) -c -o $@ $(SRC_DIR)/class_OdimStandard.cpp

$(OBJ_DIR)/module_Compare.o: $(SRC_DIR)/module_Compare.cpp $(SRC_DIR)/module_Compare.hpp \
                             $(OBJ_DIR)/class_H5Layout.o \
                             $(OBJ_DIR)/class_OdimStandard.o
	$(CXX) $(CXX_FLAGS) $(INC_FLAGS) -c -o $@ $(SRC_DIR)/module_Compare.cpp
